---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout 
  title="İletişim - Türkel Global Stands"
  description="Türkel Global Stands ile iletişime geçin. Fuar standı tasarımı ve üretimi hakkında bilgi almak için formu doldurun veya doğrudan arayın."
>
  <!-- Contact Hero -->
  <section class="py-section bg-navy text-white">
    <div class="container">
      <div class="max-w-4xl mx-auto text-center animate-on-scroll">
        <h1 class="text-h2 font-hanken font-medium mb-6">İletişime Geçin</h1>
        <p class="text-body text-white/80 text-lg">
          Fuar standı tasarımı ve üretimi hakkında bilgi almak için bizimle iletişime geçin. 
          Uzman ekibimiz size en uygun çözümü sunmak için hazır.
        </p>
      </div>
    </div>
  </section>

  <!-- Contact Form & Info -->
  <section class="py-section-lg bg-white">
    <div class="container">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 px-4 md:px-0">
        <!-- Contact Form -->
        <div class="animate-on-scroll">
          <div class="bg-cream p-6 md:p-8 rounded-lg">
            <h2 class="text-xl md:text-h4 font-semibold text-navy mb-4 md:mb-6">Mesaj Gönderin</h2>
            
            <!-- Contact Form -->
            <form id="contact-form" class="space-y-4 md:space-y-6">
              <!-- Honeypot field (hidden) -->
              <input type="text" name="website" class="hidden" tabindex="-1" autocomplete="off" />
              
              <!-- Timestamp field (hidden) -->
              <input type="hidden" name="timestamp" id="timestamp" />
              
              <!-- Name -->
              <div>
                <label for="name" class="block text-body font-medium text-black mb-2">
                  Ad Soyad <span class="text-orange">*</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 border border-grey/30 rounded-lg focus:ring-2 focus:ring-orange focus:border-orange transition-colors"
                  placeholder="Adınız ve soyadınız"
                />
                <div class="error-message text-orange text-sm mt-1 hidden" data-field="name"></div>
              </div>

              <!-- Email -->
              <div>
                <label for="email" class="block text-body font-medium text-black mb-2">
                  E-posta <span class="text-orange">*</span>
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 border border-grey/30 rounded-lg focus:ring-2 focus:ring-orange focus:border-orange transition-colors"
                  placeholder="ornek@email.com"
                />
                <div class="error-message text-orange text-sm mt-1 hidden" data-field="email"></div>
              </div>

              <!-- Phone -->
              <div>
                <label for="phone" class="block text-body font-medium text-black mb-2">
                  Telefon
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 border border-grey/30 rounded-lg focus:ring-2 focus:ring-orange focus:border-orange transition-colors"
                  placeholder="+90 5xx xxx xx xx"
                />
                <div class="error-message text-orange text-sm mt-1 hidden" data-field="phone"></div>
              </div>

              <!-- Company -->
              <div>
                <label for="company" class="block text-body font-medium text-black mb-2">
                  Şirket
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  class="w-full px-4 py-3 border border-grey/30 rounded-lg focus:ring-2 focus:ring-orange focus:border-orange transition-colors"
                  placeholder="Şirket adınız"
                />
                <div class="error-message text-orange text-sm mt-1 hidden" data-field="company"></div>
              </div>

              <!-- Subject -->
              <div>
                <label for="subject" class="block text-body font-medium text-black mb-2">
                  Konu <span class="text-orange">*</span>
                </label>
                <input
                  type="text"
                  id="subject"
                  name="subject"
                  required
                  class="w-full px-4 py-3 border border-grey/30 rounded-lg focus:ring-2 focus:ring-orange focus:border-orange transition-colors"
                  placeholder="Mesajınızın konusu"
                />
                <div class="error-message text-orange text-sm mt-1 hidden" data-field="subject"></div>
              </div>

              <!-- Message -->
              <div>
                <label for="message" class="block text-body font-medium text-black mb-2">
                  Mesaj <span class="text-orange">*</span>
                </label>
                <textarea
                  id="message"
                  name="message"
                  required
                  rows="5"
                  class="w-full px-4 py-3 border border-grey/30 rounded-lg focus:ring-2 focus:ring-orange focus:border-orange transition-colors resize-vertical"
                  placeholder="Mesajınızı buraya yazın..."
                ></textarea>
                <div class="error-message text-orange text-sm mt-1 hidden" data-field="message"></div>
              </div>

              <!-- Submit Button -->
              <div>
                <button
                  type="submit"
                  id="submit-btn"
                  class="w-full btn-primary py-4 text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span class="submit-text">Mesaj Gönder</span>
                  <span class="loading-text hidden">Gönderiliyor...</span>
                </button>
              </div>

              <!-- Success/Error Messages -->
              <div id="form-message" class="hidden p-4 rounded-lg"></div>
            </form>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="space-y-8 animate-on-scroll">
          <div>
            <h2 class="text-xl md:text-h4 font-semibold text-navy mb-4 md:mb-6">İletişim Bilgileri</h2>
            <p class="text-body text-grey mb-8">
              Sorularınız için bize ulaşabilir, ofisimizi ziyaret edebilir veya 
              doğrudan telefon ile iletişime geçebilirsiniz.
            </p>
          </div>

          <!-- Contact Details -->
          <div class="space-y-4 md:space-y-6">
            <!-- Phone -->
            <div class="flex items-start space-x-3 md:space-x-4">
              <div class="w-10 h-10 md:w-12 md:h-12 bg-orange/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-body font-semibold text-black mb-1">Telefon</h3>
                <a href="tel:+902122842300" class="text-body text-grey hover:text-orange transition-colors">
                  +90 (212) 284 23 00
                </a>
              </div>
            </div>

            <!-- Email -->
            <div class="flex items-start space-x-3 md:space-x-4">
              <div class="w-10 h-10 md:w-12 md:h-12 bg-orange/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-body font-semibold text-black mb-1">E-posta</h3>
                <a href="mailto:info@turkel.com.tr" class="text-body text-grey hover:text-orange transition-colors">
                  info@turkel.com.tr
                </a>
              </div>
            </div>

            <!-- Address -->
            <div class="flex items-start space-x-3 md:space-x-4">
              <div class="w-10 h-10 md:w-12 md:h-12 bg-orange/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-body font-semibold text-black mb-1">Adres</h3>
                <p class="text-body text-grey leading-relaxed">
                  Huzur Mah. Fatih Cad. 4.Levent Plaza 67/6<br>
                  4.Levent, Sarıyer 34396 / İstanbul – Türkiye
                </p>
              </div>
            </div>

            <!-- Working Hours -->
            <div class="flex items-start space-x-3 md:space-x-4">
              <div class="w-10 h-10 md:w-12 md:h-12 bg-orange/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-body font-semibold text-black mb-1">Çalışma Saatleri</h3>
                <p class="text-body text-grey">
                  Pazartesi - Cuma: 09:00 - 18:00<br>
                  Cumartesi: 09:00 - 14:00
                </p>
              </div>
            </div>
          </div>

          <!-- Map -->
          <div class="mt-6 md:mt-8">
            <h3 class="text-lg md:text-body font-semibold text-black mb-3 md:mb-4">Ofis Konumumuz</h3>
            <div class="rounded-lg overflow-hidden shadow-lg">
              <iframe 
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3006.0123456789!2d29.0021031!3d41.094108!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cab67eae1004f3%3A0x53319f366c2e03c9!2sT%C3%BCrkel%20Fuarc%C4%B1l%C4%B1k%20A.%C5%9E.!5e0!3m2!1str!2str!4v1694567890123!5m2!1str!2str"
                width="100%" 
                height="300" 
                style="border:0;" 
                allowfullscreen="" 
                loading="lazy" 
                referrerpolicy="no-referrer-when-downgrade"
                title="Türkel Fuarcılık A.Ş. Ofis Konumu"
                class="w-full h-64 md:h-80 rounded-lg"
              ></iframe>
            </div>
            <p class="text-sm text-grey mt-2">
              4.Levent Plaza, Sarıyer / İstanbul
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Contact form functionality
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const formMessage = document.getElementById('form-message') as HTMLDivElement;
    const timestampField = document.getElementById('timestamp') as HTMLInputElement;
    
    // Set timestamp when page loads
    timestampField.value = Date.now().toString();
    
    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Clear previous errors
      document.querySelectorAll('.error-message').forEach(el => {
        el.classList.add('hidden');
      });
      
      // Show loading state
      submitBtn.disabled = true;
      submitBtn.querySelector('.submit-text')?.classList.add('hidden');
      submitBtn.querySelector('.loading-text')?.classList.remove('hidden');
      
      try {
        // Collect form data
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // Add timestamp
        data.timestamp = parseInt(timestampField.value);
        
        // Send request
        const response = await fetch('/api/mail', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });
        
        const result = await response.json();
        
        if (result.ok) {
          // Success
          formMessage.className = 'p-4 rounded-lg bg-green-50 border border-green-200 text-green-800';
          formMessage.textContent = result.message;
          formMessage.classList.remove('hidden');
          
          // Reset form
          form.reset();
          timestampField.value = Date.now().toString();
          
          // Scroll to message
          formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          // Error
          formMessage.className = 'p-4 rounded-lg bg-red-50 border border-red-200 text-red-800';
          formMessage.textContent = result.error || 'Bir hata oluştu.';
          formMessage.classList.remove('hidden');
          
          // Show field-specific errors
          if (result.details) {
            result.details.forEach((error: any) => {
              const fieldError = document.querySelector(`[data-field="${error.path[0]}"]`);
              if (fieldError) {
                fieldError.textContent = error.message;
                fieldError.classList.remove('hidden');
              }
            });
          }
        }
      } catch (error) {
        // Network error
        formMessage.className = 'p-4 rounded-lg bg-red-50 border border-red-200 text-red-800';
        formMessage.textContent = 'Bağlantı hatası. Lütfen daha sonra tekrar deneyin.';
        formMessage.classList.remove('hidden');
      } finally {
        // Reset loading state
        submitBtn.disabled = false;
        submitBtn.querySelector('.submit-text')?.classList.remove('hidden');
        submitBtn.querySelector('.loading-text')?.classList.add('hidden');
      }
    });
  });
</script>
