---
import { generateStructuredData } from '../utils/seo';
import { getLangFromUrl, useTranslations, translatePath, getOppositeLanguagePath } from '../utils/i18n';
import { SEO_CONFIG } from '../config/seo';
import '../styles/globals.css';

export interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  noindex?: boolean;
  structuredData?: any;
  keywords?: string;
  author?: string;
  type?: 'website' | 'article';
}

const { 
  title, 
  description, 
  canonical, 
  ogImage = '/og-default.jpg',
  noindex = false,
  structuredData,
  keywords,
  author = SEO_CONFIG.defaultMeta.author,
  type = 'website'
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const canonicalURL = canonical || new URL(Astro.url.pathname, Astro.site);

// Generate hreflang URLs
const pathname = Astro.url.pathname;
const pathWithoutLang = pathname.replace(/^\/(en|tr)/, '') || '/';
const trUrl = new URL(pathWithoutLang, SEO_CONFIG.siteUrl);
const enUrl = new URL(`/en${pathWithoutLang}`, SEO_CONFIG.siteUrl);

// Generate default structured data based on page
const defaultStructuredData = (() => {
  if (pathname === '/' || pathname === '/tr') return generateStructuredData('home');
  if (pathname.includes('/hakkimizda') || pathname.includes('/about')) return generateStructuredData('about');
  if (pathname.includes('/hizmetler') || pathname.includes('/services')) return generateStructuredData('services');
  if (pathname.includes('/projeler') || pathname.includes('/projects')) return generateStructuredData('projects');
  if (pathname.includes('/iletisim') || pathname.includes('/contact')) return generateStructuredData('contact');
  return generateStructuredData('home');
})();

const finalStructuredData = structuredData || defaultStructuredData;

// Full OG Image URL
const ogImageUrl = new URL(ogImage, Astro.site).toString();
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    {keywords && <meta name="keywords" content={keywords} />}
    <meta name="author" content={author} />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Robots -->
    {noindex ? (
      <meta name="robots" content="noindex, nofollow" />
    ) : (
      <meta name="robots" content={SEO_CONFIG.defaultMeta.robots} />
    )}
    <meta name="googlebot" content={SEO_CONFIG.defaultMeta.googlebot} />
    <meta name="revisit-after" content={SEO_CONFIG.defaultMeta.revisitAfter} />
    
    <!-- Geo Location -->
    <meta name="geo.region" content="TR-34" />
    <meta name="geo.placename" content="Istanbul" />
    <meta name="geo.position" content={`${SEO_CONFIG.company.geo.latitude};${SEO_CONFIG.company.geo.longitude}`} />
    <meta name="ICBM" content={`${SEO_CONFIG.company.geo.latitude}, ${SEO_CONFIG.company.geo.longitude}`} />
    
    <!-- Language & Region -->
    <meta name="language" content={lang === 'tr' ? 'Turkish' : 'English'} />
    <meta http-equiv="content-language" content={lang} />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Hreflang Tags for Multi-language Support -->
    <link rel="alternate" hreflang="tr" href={trUrl} />
    <link rel="alternate" hreflang="en" href={enUrl} />
    <link rel="alternate" hreflang="x-default" href={trUrl} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png" />
    <link rel="shortcut icon" href="/favicon-32x32.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#E67411" />
    <meta name="msapplication-TileColor" content="#E67411" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:site_name" content={SEO_CONFIG.og.siteName} />
    <meta property="og:locale" content={SEO_CONFIG.og.locale[lang]} />
    {lang === 'tr' && <meta property="og:locale:alternate" content="en_US" />}
    {lang === 'en' && <meta property="og:locale:alternate" content="tr_TR" />}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content={SEO_CONFIG.twitter.card} />
    <meta name="twitter:site" content={SEO_CONFIG.twitter.site} />
    <meta name="twitter:creator" content={SEO_CONFIG.twitter.creator} />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />
    <meta name="twitter:image:alt" content={title} />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(finalStructuredData)}></script>
  </head>
  
  <body>
    <!-- Skip to content link for accessibility -->
    <a href="#main" class="skip-link">Ana iÃ§eriÄŸe geÃ§</a>
    
    <!-- Header -->
    <header id="header" class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-beige/50">
      <nav class="container" aria-label="Ana navigasyon">
        <div class="flex items-center justify-between py-4">
          <!-- Logo -->
          <a href={translatePath('/', lang)} class="flex-shrink-0" aria-label="TÃ¼rkel Global Stands Ana Sayfa">
            <img 
              src="/logo.png" 
              alt="TÃ¼rkel Global Stands Logo" 
              width="194" 
              height="60"
              class="h-12 w-auto"
              loading="eager"
            />
          </a>
          
          <div class="flex items-center space-x-4">
            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-6">
              <a href={translatePath('/', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/', lang) ? 'text-navy' : ''}`}>{t('nav.home')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/hakkimizda', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hakkimizda', lang) ? 'text-navy' : ''}`}>{t('nav.about')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/hizmetler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hizmetler', lang) ? 'text-navy' : ''}`}>{t('nav.services')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/projeler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/projeler', lang) ? 'text-navy' : ''}`}>{t('nav.projects')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/iletisim', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/iletisim', lang) ? 'text-navy' : ''}`}>{t('nav.contact')}</a>
            </div>
            
            <!-- Language Switcher -->
            <div class="hidden md:flex items-center space-x-2 ml-4">
              <a 
                href={getOppositeLanguagePath(Astro.url)}
                class="flex items-center space-x-1 px-3 py-1 rounded-md hover:bg-beige/50 transition-colors text-sm font-medium"
                aria-label={lang === 'tr' ? 'Switch to English' : 'TÃ¼rkÃ§e\'ye geÃ§'}
              >
                <span class="text-lg">{lang === 'tr' ? 'ðŸ‡ºðŸ‡¸' : 'ðŸ‡¹ðŸ‡·'}</span>
                <span>{lang === 'tr' ? 'EN' : 'TR'}</span>
              </a>
            </div>
          </div>
          
          <!-- Mobile Menu Button -->
          <button 
            id="mobile-menu-button"
            class="md:hidden p-2 rounded-lg hover:bg-beige/50 transition-colors"
            aria-label="MenÃ¼yÃ¼ aÃ§/kapat"
            aria-expanded="false"
            aria-controls="mobile-menu"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
        
                <!-- Mobile Navigation -->
                <div
                  id="mobile-menu"
                  class="md:hidden hidden border-t border-beige/50 py-4"
                  role="menu"
                >
                  <div class="flex flex-col space-y-4">
                    <a href={translatePath('/', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.home')}</a>
                    <a href={translatePath('/hakkimizda', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hakkimizda', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.about')}</a>
                    <a href={translatePath('/hizmetler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hizmetler', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.services')}</a>
                    <a href={translatePath('/projeler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/projeler', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.projects')}</a>
                    <a href={translatePath('/iletisim', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/iletisim', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.contact')}</a>
                    
                    <!-- Mobile Language Switcher -->
                    <div class="border-t border-beige/50 pt-4 mt-4">
                      <a 
                        href={getOppositeLanguagePath(Astro.url)}
                        class="flex items-center space-x-2 nav-link"
                        aria-label={lang === 'tr' ? 'Switch to English' : 'TÃ¼rkÃ§e\'ye geÃ§'}
                      >
                        <span class="text-lg">{lang === 'tr' ? 'ðŸ‡ºðŸ‡¸' : 'ðŸ‡¹ðŸ‡·'}</span>
                        <span>{lang === 'tr' ? 'English' : 'TÃ¼rkÃ§e'}</span>
                      </a>
                    </div>
                  </div>
                </div>
      </nav>
    </header>
    
    <!-- Main Content -->
    <main id="main">
      <slot />
    </main>
    
    <!-- Footer -->
    <footer class="bg-navy text-white">
      <div class="container py-12">
        <!-- Main Footer Content -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
          <!-- Logo & Company Info -->
          <div class="lg:col-span-2">
            <img 
              src="/logo-white.png" 
              alt="TÃ¼rkel Global Stands Logo" 
              width="243" 
              height="74"
              class="h-12 w-auto mb-4"
              loading="lazy"
            />
            <p class="text-sm text-white/70 leading-relaxed max-w-md">
              {t('footer.description')}
            </p>
          </div>
          
          <!-- Quick Links -->
          <div>
            <h3 class="text-sm font-semibold text-white mb-4 uppercase tracking-wider">{t('footer.quickLinks')}</h3>
            <nav class="flex flex-col space-y-2" aria-label="Footer navigasyon">
              <a href={translatePath('/', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/', lang) ? 'text-orange' : ''}`}>{t('nav.home')}</a>
              <a href={translatePath('/hakkimizda', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/hakkimizda', lang) ? 'text-orange' : ''}`}>{t('nav.about')}</a>
              <a href={translatePath('/hizmetler', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/hizmetler', lang) ? 'text-orange' : ''}`}>{t('nav.services')}</a>
              <a href={translatePath('/projeler', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/projeler', lang) ? 'text-orange' : ''}`}>{t('nav.projects')}</a>
              <a href={translatePath('/iletisim', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/iletisim', lang) ? 'text-orange' : ''}`}>{t('nav.contact')}</a>
            </nav>
          </div>
          
          <!-- Contact Info -->
          <div>
            <h3 class="text-sm font-semibold text-white mb-4 uppercase tracking-wider">{t('footer.contact')}</h3>
            <div class="space-y-3">
              <div>
                <a href="mailto:globalstand@turkel.com.tr" class="text-sm text-white/70 hover:text-orange transition-colors block">
                  globalstand@turkel.com.tr
                </a>
              </div>
              <div>
                <a href="tel:+902122842300" class="text-sm text-white/70 hover:text-orange transition-colors block">
                  +90 (212) 284 23 00
                </a>
              </div>
              <div>
                <p class="text-sm text-white/70 leading-relaxed">
                  4.Levent Plaza, SarÄ±yer<br>
                  Ä°stanbul, TÃ¼rkiye
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Divider -->
        <div class="border-t border-white/10 pt-6">
          <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <!-- Copyright -->
            <p class="text-sm text-white/50">
              Â© 2025 {t('footer.company')}. {t('footer.rights')}
            </p>
            
            <!-- Additional Links -->
            <div class="flex space-x-6">
              <a href={translatePath('/iletisim', lang)} class="text-sm text-white/50 hover:text-orange transition-colors">
                {lang === 'en' ? 'Privacy Policy' : 'Gizlilik PolitikasÄ±'}
              </a>
              <a href={translatePath('/iletisim', lang)} class="text-sm text-white/50 hover:text-orange transition-colors">
                {lang === 'en' ? 'Terms of Use' : 'KullanÄ±m ÅžartlarÄ±'}
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- Mobile Menu Script -->
    <script>
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
          const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
          
          mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // Scroll-based animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
          }
        });
      }, observerOptions);
      
      // Observe all elements with animate-on-scroll class
      document.querySelectorAll('.animate-on-scroll').forEach((el) => {
        observer.observe(el);
      });
    </script>
    
  </body>
</html>
