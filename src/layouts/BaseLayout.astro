---
import { generateStructuredData } from '../utils/seo';
import { getLangFromUrl, useTranslations, translatePath } from '../utils/i18n';
import '../styles/globals.css';

export interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  noindex?: boolean;
  structuredData?: any;
}

const { 
  title, 
  description, 
  canonical, 
  ogImage = '/og-default.jpg',
  noindex = false,
  structuredData
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const canonicalURL = canonical || new URL(Astro.url.pathname, Astro.site);

// Generate default structured data based on page
const defaultStructuredData = (() => {
  const pathname = Astro.url.pathname;
  if (pathname === '/') return generateStructuredData('home');
  if (pathname === '/hakkimizda') return generateStructuredData('about');
  if (pathname === '/hizmetler') return generateStructuredData('services');
  if (pathname === '/projeler') return generateStructuredData('projects');
  if (pathname === '/iletisim') return generateStructuredData('contact');
  return generateStructuredData('home');
})();

const finalStructuredData = structuredData || defaultStructuredData;
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png" />
    <link rel="shortcut icon" href="/favicon-32x32.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#E67411" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImage, Astro.site)} />
    <meta property="og:site_name" content="Türkel Global Stands" />
    <meta property="og:locale" content="tr_TR" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(ogImage, Astro.site)} />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(finalStructuredData)}></script>
  </head>
  
  <body>
    <!-- Skip to content link for accessibility -->
    <a href="#main" class="skip-link">Ana içeriğe geç</a>
    
    <!-- Header -->
    <header id="header" class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-beige/50">
      <nav class="container" aria-label="Ana navigasyon">
        <div class="flex items-center justify-between py-4">
          <!-- Logo -->
          <a href={translatePath('/', lang)} class="flex-shrink-0" aria-label="Türkel Global Stands Ana Sayfa">
            <img 
              src="/logo.png" 
              alt="Türkel Global Stands Logo" 
              width="194" 
              height="60"
              class="h-12 w-auto"
              loading="eager"
            />
          </a>
          
          <div class="flex items-center space-x-4">
            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-6">
              <a href={translatePath('/', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/', lang) ? 'text-navy' : ''}`}>{t('nav.home')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/hakkimizda', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hakkimizda', lang) ? 'text-navy' : ''}`}>{t('nav.about')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/hizmetler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hizmetler', lang) ? 'text-navy' : ''}`}>{t('nav.services')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/projeler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/projeler', lang) ? 'text-navy' : ''}`}>{t('nav.projects')}</a>
              <span class="text-orange font-medium">/</span>
              <a href={translatePath('/iletisim', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/iletisim', lang) ? 'text-navy' : ''}`}>{t('nav.contact')}</a>
            </div>
            
            <!-- Language Switcher -->
            <div class="hidden md:flex items-center space-x-2 ml-4">
              <a 
                href={lang === 'tr' ? `/en${Astro.url.pathname}` : Astro.url.pathname.replace('/en', '')}
                class="flex items-center space-x-1 px-3 py-1 rounded-md hover:bg-beige/50 transition-colors text-sm font-medium"
                aria-label={lang === 'tr' ? 'Switch to English' : 'Türkçe\'ye geç'}
              >
                <span class="text-lg">{lang === 'tr' ? '🇺🇸' : '🇹🇷'}</span>
                <span>{lang === 'tr' ? 'EN' : 'TR'}</span>
              </a>
            </div>
          </div>
          
          <!-- Mobile Menu Button -->
          <button 
            id="mobile-menu-button"
            class="md:hidden p-2 rounded-lg hover:bg-beige/50 transition-colors"
            aria-label="Menüyü aç/kapat"
            aria-expanded="false"
            aria-controls="mobile-menu"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
        
                <!-- Mobile Navigation -->
                <div
                  id="mobile-menu"
                  class="md:hidden hidden border-t border-beige/50 py-4"
                  role="menu"
                >
                  <div class="flex flex-col space-y-4">
                    <a href={translatePath('/', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.home')}</a>
                    <a href={translatePath('/hakkimizda', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hakkimizda', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.about')}</a>
                    <a href={translatePath('/hizmetler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/hizmetler', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.services')}</a>
                    <a href={translatePath('/projeler', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/projeler', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.projects')}</a>
                    <a href={translatePath('/iletisim', lang)} class={`nav-link ${Astro.url.pathname === translatePath('/iletisim', lang) ? 'text-navy' : ''}`} role="menuitem">{t('nav.contact')}</a>
                    
                    <!-- Mobile Language Switcher -->
                    <div class="border-t border-beige/50 pt-4 mt-4">
                      <a 
                        href={lang === 'tr' ? `/en${Astro.url.pathname}` : Astro.url.pathname.replace('/en', '')}
                        class="flex items-center space-x-2 nav-link"
                        aria-label={lang === 'tr' ? 'Switch to English' : 'Türkçe\'ye geç'}
                      >
                        <span class="text-lg">{lang === 'tr' ? '🇺🇸' : '🇹🇷'}</span>
                        <span>{lang === 'tr' ? 'English' : 'Türkçe'}</span>
                      </a>
                    </div>
                  </div>
                </div>
      </nav>
    </header>
    
    <!-- Main Content -->
    <main id="main">
      <slot />
    </main>
    
    <!-- Footer -->
    <footer class="bg-navy text-white">
      <div class="container py-12">
        <!-- Main Footer Content -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
          <!-- Logo & Company Info -->
          <div class="lg:col-span-2">
            <img 
              src="/logo-white.png" 
              alt="Türkel Global Stands Logo" 
              width="243" 
              height="74"
              class="h-12 w-auto mb-4"
              loading="lazy"
            />
            <p class="text-sm text-white/70 leading-relaxed max-w-md">
              {t('footer.description')}
            </p>
          </div>
          
          <!-- Quick Links -->
          <div>
            <h3 class="text-sm font-semibold text-white mb-4 uppercase tracking-wider">{t('footer.quickLinks')}</h3>
            <nav class="flex flex-col space-y-2" aria-label="Footer navigasyon">
              <a href={translatePath('/', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/', lang) ? 'text-orange' : ''}`}>{t('nav.home')}</a>
              <a href={translatePath('/hakkimizda', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/hakkimizda', lang) ? 'text-orange' : ''}`}>{t('nav.about')}</a>
              <a href={translatePath('/hizmetler', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/hizmetler', lang) ? 'text-orange' : ''}`}>{t('nav.services')}</a>
              <a href={translatePath('/projeler', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/projeler', lang) ? 'text-orange' : ''}`}>{t('nav.projects')}</a>
              <a href={translatePath('/iletisim', lang)} class={`text-sm text-white/70 hover:text-orange transition-colors ${Astro.url.pathname === translatePath('/iletisim', lang) ? 'text-orange' : ''}`}>{t('nav.contact')}</a>
            </nav>
          </div>
          
          <!-- Contact Info -->
          <div>
            <h3 class="text-sm font-semibold text-white mb-4 uppercase tracking-wider">{t('footer.contact')}</h3>
            <div class="space-y-3">
              <div>
                <a href="mailto:globalstand@turkel.com.tr" class="text-sm text-white/70 hover:text-orange transition-colors block">
                  globalstand@turkel.com.tr
                </a>
              </div>
              <div>
                <a href="tel:+902122842300" class="text-sm text-white/70 hover:text-orange transition-colors block">
                  +90 (212) 284 23 00
                </a>
              </div>
              <div>
                <p class="text-sm text-white/70 leading-relaxed">
                  4.Levent Plaza, Sarıyer<br>
                  İstanbul, Türkiye
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Divider -->
        <div class="border-t border-white/10 pt-6">
          <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <!-- Copyright -->
            <p class="text-sm text-white/50">
              © 2025 {t('footer.company')}. {t('footer.rights')}
            </p>
            
            <!-- Additional Links -->
            <div class="flex space-x-6">
              <a href={translatePath('/iletisim', lang)} class="text-sm text-white/50 hover:text-orange transition-colors">
                {lang === 'en' ? 'Privacy Policy' : 'Gizlilik Politikası'}
              </a>
              <a href={translatePath('/iletisim', lang)} class="text-sm text-white/50 hover:text-orange transition-colors">
                {lang === 'en' ? 'Terms of Use' : 'Kullanım Şartları'}
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- Mobile Menu Script -->
    <script>
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
          const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
          
          mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // Scroll-based animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
          }
        });
      }, observerOptions);
      
      // Observe all elements with animate-on-scroll class
      document.querySelectorAll('.animate-on-scroll').forEach((el) => {
        observer.observe(el);
      });
    </script>
    
  </body>
</html>
